{% load static humanize %}
{% load math_filters %}

<article class="card team-card {% if team.team_ID == active_team_id %}active-team{% endif %}"
         data-name="{{ team.team_name|lower }}"
         data-desc="{{ team.description|default:''|lower }}"
         data-owner="{% if team.owner.username %}{{ team.owner.username|lower }}{% else %}owner-{{ team.user_id_owner }}{% endif %}">

  <!-- Team Icon -->
  <div class="team-icon-container">
    <img src="{{ team.icon_url|default:'/static/images/default-team-icon.png' }}"
         alt="{{ team.team_name }} icon"
         class="team-icon"
         onerror="this.src='{% static 'images/default-team-icon.png' %}'">
    {% if team.team_ID == active_team_id %}
      <div class="active-team-badge">Active</div>
    {% endif %}
  </div>

  <!-- Team Header -->
  <div class="card-header">
    <h3 class="team-name">{{ team.team_name }}</h3>
  </div>

  <!-- Team Body -->
  <div class="card-body">
    <p class="team-desc">
      {% if team.description %}
        {{ team.description }}
      {% else %}
        <em>No description provided.</em>
      {% endif %}
    </p>

    <!-- Team Members -->
    <div class="team-members">
      {% with team.members as members %}
        {% for member in members|slice:":5" %}
          <img src="{{ member.user.profile_picture|default:'/static/images/default-avatar.png' }}"
               alt="{{ member.user.username }}"
               class="member-avatar"
               title="{{ member.user.username }}"
               onerror="this.src='{% static 'images/default-avatar.png' %}'">
        {% endfor %}
        {% if members|length > 5 %}
          <div class="member-avatar more" title="And {{ members|length|add:-5 }} more">
            +{{ members|length|add:-5 }}
          </div>
        {% endif %}
      {% endwith %}
    </div>
  </div>

  <!-- Footer -->
  <div class="card-footer footer-actions">
    {% if team.team_ID == active_team_id %}
      <button class="active-team-btn" disabled>
        <span class="active-indicator"></span>
        Active Team
      </button>
    {% else %}
      <button class="switch-team-btn" data-team-id="{{ team.team_ID }}" data-team-name="{{ team.team_name }}">
        Switch to Team
      </button>
    {% endif %}
    
    {% if team.user_id_owner == request.session.user_ID %}
      <button class="edit-team-btn" data-team-id="{{ team.team_ID }}">Edit</button>
    {% else %}
      <button class="view-team-btn" data-team-id="{{ team.team_ID }}">View</button>
      <button class="leave-team-btn" data-team-id="{{ team.team_ID }}">Leave</button>
    {% endif %}
  </div>
</article>