<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}CollabSphere{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    {% load static %}
    <link href="{% static 'css/notifications.css' %}" rel="stylesheet">
    {% block extra_css %}
    <style>

    .navbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 2000;
    }

    body {
    padding-top: 60px;
    }

    nav.navbar a.nav-link:not(.btn) {
    color: #333 !important;
    padding: 8px 12px !important;
    border-radius: 6px !important;
    display: inline-block !important;
    background-color: transparent !important;
    transition: background-color .18s ease, color .18s ease !important;
    cursor: pointer !important;
    }

    nav.navbar a.nav-link:not(.btn):hover,
    nav.navbar a.nav-link:not(.btn).hovering {
    background-color: rgba(0,0,0,0.08) !important; /* slightly darker */
    color: #0d6efd !important;
    }

    nav.navbar a.btn {
    }
    
    .page-container {
        padding: 20px;
        min-height: calc(100vh - 70px);
        background-color: #FAFBFB;
    }
    </style>
    {% endblock %}


</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-light bg-light shadow-sm px-4">
        <div class="container-fluid">
            <!-- Left: Logo + Name -->
          <img src="{% static 'images/logo.png' %}" alt="CollabSphere Logo" style="height:40px; margin-right:10px;">
          <div style="margin-right: 40px; font-size: 1.5rem; font-weight: bold; color: #245d8b;">CollabSphere</div>


            <!-- Right: Nav links -->
            <div class="d-flex align-items-center ms-auto">
                <a class="nav-link me-3" href="{% url 'home' %}">Home</a>
                <a class="nav-link me-3" href="{% url 'teams' %}">Teams</a>
                <a class="nav-link me-3" href="{% url 'wellbeing_dashboard' %}">Check Ins</a>
                <a class="nav-link me-3" href="#">Calendar</a>
                <a class="nav-link me-3" href="#">Help</a>

                <!-- User logo/avatar -->
                <div class="dropdown">
                    <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
          {% load static %}
            <img id="profile-img"
                src="{% if user_data.profile_picture %}{{ user_data.profile_picture }}{% else %}{% static 'images/circle-user.png' %}{% endif %}"
                alt="Profile Image"
                class="rounded-circle border border-2 border-primary shadow-sm"
                width="40" height="40"
                style="object-fit: cover; cursor: pointer; "
                onerror="this.onerror=null; this.src='{% static 'images/circle-user.png' %}';">


                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
                        <li><a class="dropdown-item"  href="{% url 'profile' %}">Profile</a></li>
                        <li><a class="dropdown-item" href="#">Settings</a></li>
                        <li><a class="dropdown-item position-relative" href="{% url 'notifications:list' %}">
                            Notifications
                            <span class="notification-badge" id="notification-count" style="display: none;">0</span>
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="{% url 'logout' %}">Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

  <!-- Page Content -->
  <div class="page-container">
    {% block content %}{% endblock %}
  </div>
</body>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    function loadNotifications() {
        fetch('/notifications/')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })
            .then(html => {
                const container = document.getElementById('notifications-container');
                if (container) {
                    container.innerHTML = html;
                }
            })
            .catch(error => {
                console.error('Error loading notifications:', error);
            });

        fetch('/notifications/unread-count/')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                const badge = document.getElementById('notification-count');
                if (badge) {
                    if (data.count > 0) {
                        badge.textContent = data.count;
                        badge.style.display = 'block';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            })
            .catch(error => {
                console.error('Error loading notification count:', error);
            });
    }

    // Load notifications when the page loads
    document.addEventListener('DOMContentLoaded', loadNotifications);

    // Refresh notifications every minute
    setInterval(loadNotifications, 60000);

function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}
</script>

</html>
